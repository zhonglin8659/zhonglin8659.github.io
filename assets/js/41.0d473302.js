(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{565:function(t,s,a){"use strict";a.r(s),a=a(4),a=Object(a.a)({},(function(){var t=this,s=t.$createElement;return(s=t._self._c||s)("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"问题原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题原因"}},[t._v("#")]),t._v(" 问题原因")]),t._v(" "),s("blockquote",[s("p",[t._v("Podman 容器在暴露端口时，可能会绕过 UFW（Uncomplicated Firewall）的规则。这是因为 Podman（尤其是 rootful 模式下）会直接操作底层防火墙（如 iptables 或 nftables），自动打开所需端口，而 UFW 作为 iptables 的前端，无法完全控制这些变化，导致容器端口即使在 UFW 中被阻塞，也可能从外部访问。这是一种常见行为，与 Docker 类似，被设计为确保容器启动时端口立即可用。但这会带来安全隐患，尤其在生产环境中")])]),t._v(" "),s("h2",{attrs:{id:"确认问题并启用日志调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#确认问题并启用日志调试"}},[t._v("#")]),t._v(" 确认问题并启用日志调试")]),t._v(" "),s("h3",{attrs:{id:"先确认-ufw-确实在阻塞或绕过流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#先确认-ufw-确实在阻塞或绕过流量"}},[t._v("#")]),t._v(" 先确认 UFW 确实在阻塞或绕过流量")]),t._v(" "),s("p",[t._v("启用 UFW 日志")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ufw logging on\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("重载 UFW")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ufw reload\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("监控日志")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("tail -f /var/log/ufw.log\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("启动一个测试容器，例如："),s("code",[t._v("podman run -d -p 8080:80 nginx")]),t._v("（暴露端口 8080）")]),t._v(" "),s("p",[t._v("从外部尝试访问主机 IP 的 8080 端口，并检查日志中是否有 "),s("code",[t._v("[UFW BLOCK]")]),t._v(" 条目，注意接口如"),s("code",[t._v("IN=enp0s31f6 OUT=podman1")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sugarys.oss-cn-beijing.aliyuncs.com/document/linux/image-20251114145935554.png",alt:"image-20251114145935554"}})]),t._v(" "),s("p",[t._v("这是一条 "),s("strong",[t._v("UFW 防火墙主动阻止（BLOCK）")]),t._v(" 的 "),s("strong",[t._v("入站 TCP 连接请求")]),t._v(" 日志。")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"日志原文"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志原文"}},[t._v("#")]),t._v(" 日志原文：")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kernel: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UFW BLOCK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("enp0s31f6 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OUT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("podman1 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MAC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("a4:4c:c8:00:38:cc:70:4e:6b:80:98:f1:08:00 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SRC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.180 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.89")]),t._v(".0.4 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LEN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TOS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x00 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PREC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x00 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TTL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("126")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3214")]),t._v(" DF "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PROTO")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("TCP "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SPT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4846")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DPT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("WINDOW")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64240")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RES")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x00 SYN "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("URGP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"逐字段详细解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#逐字段详细解释"}},[t._v("#")]),t._v(" 逐字段详细解释：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("值")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("kernel:")])]),t._v(" "),s("td",[t._v("—")]),t._v(" "),s("td",[t._v("日志来自 Linux 内核（netfilter/iptables）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("[UFW BLOCK]")])]),t._v(" "),s("td",[t._v("—")]),t._v(" "),s("td",[s("strong",[t._v("UFW 防火墙阻止并丢弃了这个包")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("IN=enp0s31f6")])]),t._v(" "),s("td",[s("code",[t._v("enp0s31f6")])]),t._v(" "),s("td",[t._v("数据包 "),s("strong",[t._v("从物理网卡进入")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("OUT=podman1")])]),t._v(" "),s("td",[s("code",[t._v("podman1")])]),t._v(" "),s("td",[t._v("数据包 "),s("strong",[t._v("本应转发到 podman1 网桥")]),t._v("（Podman 容器网络）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("MAC=...")])]),t._v(" "),s("td",[s("code",[t._v("a4:4c:c8:00:38:cc:70:4e:6b:80:98:f1:08:00")])]),t._v(" "),s("td",[s("strong",[t._v("MAC 地址对")]),t._v("："),s("br"),t._v("• 源 MAC: "),s("code",[t._v("a4:4c:c8:00:38:cc")]),t._v("（内网设备）"),s("br"),t._v("• 目的 MAC: "),s("code",[t._v("70:4e:6b:80:98:f1")]),t._v("（宿主机网卡）"),s("br"),t._v("• 最后 "),s("code",[t._v("08:00")]),t._v(" 常为虚拟 MAC 尾部")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("SRC=192.168.1.180")])]),t._v(" "),s("td",[s("code",[t._v("192.168.1.180")])]),t._v(" "),s("td",[s("strong",[t._v("源 IP")]),t._v("：内网某台设备（电脑、手机、IoT 等）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("DST=10.89.0.4")])]),t._v(" "),s("td",[s("code",[t._v("10.89.0.4")])]),t._v(" "),s("td",[s("strong",[t._v("目标 IP")]),t._v("："),s("strong",[t._v("Podman 容器内的 IP")]),t._v("（属于 podman 网络子网）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("LEN=52")])]),t._v(" "),s("td",[t._v("52 字节")]),t._v(" "),s("td",[t._v("IP 包总长（典型 TCP SYN 小包）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("TOS=0x00")])]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("服务类型（普通）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("PREC=0x00")])]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("优先级（无）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("TTL=126")])]),t._v(" "),s("td",[t._v("126")]),t._v(" "),s("td",[t._v("生存时间，"),s("strong",[t._v("说明经过了至少 2 跳路由")]),t._v("（常见 Windows 默认 128 - 2）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ID=3214")])]),t._v(" "),s("td",[t._v("3214")]),t._v(" "),s("td",[t._v("IP 分片 ID")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("DF")])]),t._v(" "),s("td",[t._v("Don’t Fragment")]),t._v(" "),s("td",[t._v("不允许分片")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("PROTO=TCP")])]),t._v(" "),s("td",[t._v("TCP")]),t._v(" "),s("td",[t._v("协议为 "),s("strong",[t._v("TCP")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("SPT=4846")])]),t._v(" "),s("td",[t._v("4846")]),t._v(" "),s("td",[s("strong",[t._v("源端口")]),t._v("（客户端随机高位端口）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("DPT=8502")])]),t._v(" "),s("td",[t._v("8502")]),t._v(" "),s("td",[s("strong",[t._v("目标端口")]),t._v("：尝试连接容器内的 "),s("strong",[t._v("8502 端口服务")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("WINDOW=64240")])]),t._v(" "),s("td",[t._v("64240")]),t._v(" "),s("td",[t._v("TCP 窗口大小（正常）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("RES=0x00")])]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("保留字段")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("SYN")])]),t._v(" "),s("td",[s("strong",[t._v("SYN 标志位")])]),t._v(" "),s("td",[s("strong",[t._v("TCP 三次握手第一步")]),t._v("：发起连接")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("URGP=0")])]),t._v(" "),s("td",[t._v("0")]),t._v(" "),s("td",[t._v("紧急指针")])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"大白话翻译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#大白话翻译"}},[t._v("#")]),t._v(" 大白话翻译：")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("内网一台设备（192.168.1.180）尝试通过 TCP 连接你服务器上 "),s("strong",[t._v("Podman 容器内某个服务的 8502 端口")]),t._v("（IP: 10.89.0.4），但 UFW 防火墙在包从物理网卡 "),s("code",[t._v("enp0s31f6")]),t._v(" 进入、准备转发到 "),s("code",[t._v("podman1")]),t._v(" 网桥时，"),s("strong",[t._v("直接阻止并丢弃了这个连接请求")]),t._v("。")])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"关键信息总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关键信息总结"}},[t._v("#")]),t._v(" 关键信息总结：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("项目")]),t._v(" "),s("th",[t._v("内容")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("行为")])]),t._v(" "),s("td",[t._v("外网/内网设备主动发起 TCP 连接")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("目标")])]),t._v(" "),s("td",[t._v("Podman 容器内的服务（"),s("code",[t._v("10.89.0.4:8502")]),t._v("）")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("端口")])]),t._v(" "),s("td",[s("code",[t._v("8502")]),t._v(" —— "),s("strong",[t._v("非标准端口")]),t._v("，常见于："),s("br"),t._v("• 自建 Web 服务（如 Streamlit 默认 8501，可能是 8502 变体）"),s("br"),t._v("• 某些微服务、监控面板、内部 API")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("结果")])]),t._v(" "),s("td",[s("strong",[t._v("连接失败")]),t._v("，客户端会超时")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("是否危险？")])]),t._v(" "),s("td",[s("strong",[t._v("不一定")]),t._v("，但需警惕")])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"安全分析-这可能是"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全分析-这可能是"}},[t._v("#")]),t._v(" 安全分析：这可能是？")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("可能性")]),t._v(" "),s("th",[t._v("解释")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("1. "),s("strong",[t._v("正常内网访问")])]),t._v(" "),s("td",[t._v("有人知道容器服务存在，尝试访问（如开发测试）")])]),t._v(" "),s("tr",[s("td",[t._v("2. "),s("strong",[t._v("误操作/扫描")])]),t._v(" "),s("td",[t._v("有人在内网扫端口，碰到了 8502")])]),t._v(" "),s("tr",[s("td",[t._v("3. "),s("strong",[t._v("恶意探测")])]),t._v(" "),s("td",[t._v("攻击者尝试访问未暴露的服务（若容器有漏洞 → 风险）")])]),t._v(" "),s("tr",[s("td",[t._v("4. "),s("strong",[t._v("容器服务不应暴露")])]),t._v(" "),s("td",[t._v("你可能不希望 "),s("code",[t._v("10.89.0.x")]),t._v(" 被内网直接访问")])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"建议操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建议操作"}},[t._v("#")]),t._v(" 建议操作")]),t._v(" "),s("h4",{attrs:{id:"_1-查容器是谁在用-8502-端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-查容器是谁在用-8502-端口"}},[t._v("#")]),t._v(" 1. "),s("strong",[t._v("查容器是谁在用 8502 端口")])]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("podman "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" --format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("{{.Names}}"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("{{.Ports}}"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v('{{.Image}}"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("或更精确：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("podman network inspect podman "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.89")]),t._v(".0.4 -B "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\npodman "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("podman network inspect podman "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -B2 -A1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.89")]),t._v(".0.4 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" Container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v("}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h4",{attrs:{id:"_2-是否应该允许"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-是否应该允许"}},[t._v("#")]),t._v(" 2. "),s("strong",[t._v("是否应该允许？")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("不建议直接放通")]),t._v("，除非你明确需要内网访问该服务。")]),t._v(" "),s("li",[t._v("推荐方式："),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只允许特定 IP 访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ufw allow from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.180 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.89")]),t._v(".0.4 port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8502")]),t._v(" proto tcp\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),t._v("或通过 "),s("strong",[t._v("反向代理（如 Nginx/Traefik）")]),t._v(" 安全暴露。")])]),t._v(" "),s("h4",{attrs:{id:"_3-彻底阻止-默认已阻止"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-彻底阻止-默认已阻止"}},[t._v("#")]),t._v(" 3. "),s("strong",[t._v("彻底阻止（默认已阻止）")])]),t._v(" "),s("p",[t._v("你当前 "),s("strong",[t._v("UFW 默认策略是 DENY")]),t._v("，所以已安全。")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"总结-一句话解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结-一句话解释"}},[t._v("#")]),t._v(" 总结：一句话解释")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("内网某设备（192.168.1.180）尝试连接你 Podman 容器内的 8502 端口服务，但被 UFW 防火墙在转发到 podman1 网桥前直接阻止，属于正常安全行为，可忽略或进一步限制。")])])]),t._v(" "),s("h2",{attrs:{id:"使用-ufw-route-rules-允许特定流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-ufw-route-rules-允许特定流量"}},[t._v("#")]),t._v(" 使用 UFW Route Rules 允许特定流量")]),t._v(" "),s("blockquote",[s("p",[t._v("UFW 支持路由规则，可以明确允许从外部接口。如 "),s("code",[t._v("enp0s31f6")]),t._v(" 到 "),s("code",[t._v("podman1")]),t._v(" 网络接口的流量转发，从而防止绕过")])]),t._v(" "),s("h3",{attrs:{id:"识别外部接口-通常是-eth0-或-enp1s0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#识别外部接口-通常是-eth0-或-enp1s0"}},[t._v("#")]),t._v(" 识别外部接口（通常是 eth0 或 enp1s0）")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" -o addr show "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v(' " " '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),t._v("}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/\\/.*$//'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"识别-podman-网络接口-通常是-cni-podman0-或-podman0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#识别-podman-网络接口-通常是-cni-podman0-或-podman0"}},[t._v("#")]),t._v(" 识别 Podman 网络接口（通常是 "),s("code",[t._v("cni-podman0")]),t._v(" 或 "),s("code",[t._v("podman0")]),t._v("）")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" -o addr show "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v(' " " '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),t._v("}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/\\/.*$//'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"添加路由规则-例如对于端口-8080"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加路由规则-例如对于端口-8080"}},[t._v("#")]),t._v(" 添加路由规则 例如对于端口 8080")]),t._v(" "),s("blockquote",[s("p",[t._v("允许从物理网卡 enp0s31f6 进来的数据包，经过路由转发到 podman1 网桥（Podman 容器网络），只要目标是任意 IP 的 8080 端口，就放行")])]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ufw route allow "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" on enp0s31f6 out on podman1 to any port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"重载-ufw"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重载-ufw"}},[t._v("#")]),t._v(" 重载 UFW")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ufw reload\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"重新访问即可"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重新访问即可"}},[t._v("#")]),t._v(" 重新访问即可")]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("http:")]),t._v("//192.168.0.41:8080\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])}),[],!1,null,null,null),s.default=a.exports}}]);